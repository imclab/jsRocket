/*! jsRocket - v0.0.1 - 2012-11-24
* https://github.com/mog/jsRocket
* Copyright (c) 2012 mog; Licensed MIT*/

var JSRocket={};JSRocket.SyncData=function(){"use strict";function t(t){return e[t]}function n(t){for(var n=0;n<e.length;n++)if(e[n].name===t)return n;return-1}function r(){return e.length}function i(t){var n=new JSRocket.Track;n.name=t,e.push(n)}var e=[];return{getTrack:t,getIndexForName:n,getTrackLength:r,createIndex:i}},JSRocket.Track=function(){"use strict";function o(s){var o=Math.floor(s),a=u(o),f=a.low,l=a.high,c;if(isNaN(f))return NaN;if(isNaN(l)||i[f].interpolation===e)return i[f].value;switch(i[f].interpolation){case t:return c=(s-f)/(l-f),i[f].value+(i[l].value-i[f].value)*c;case n:return c=(s-f)/(l-f),c=c*c*(3-2*c),i[l].value*c+i[f].value*(1-c);case r:return c=Math.pow((s-f)/(l-f),2),i[f].value+(i[l].value-i[f].value)*c}return NaN}function u(e){var t=NaN,n=NaN;for(var r=0;r<s.length;r++)if(s[r]<=e)t=s[r];else if(s[r]>=e){n=s[r];break}return{low:t,high:n}}function a(e,t,n){f(e),s.push(e),i[e]={value:t,interpolation:n},s=s.sort(function(e,t){return e-t})}function f(e){s.indexOf(e)>-1&&(s.splice(s.indexOf(e),1),delete i[e])}var e=0,t=1,n=2,r=3,i=[],s=[];return{getValue:o,add:a,remove:f}},JSRocket.SyncDevicePlayer=function(e){"use strict";function i(e){t=new XMLHttpRequest;if(t===null){r.error();return}t.open("GET",e,!0),t.onreadystatechange=s,t.send()}function s(){t.readyState===4&&(t.status<300?o(t.responseText):r.error())}function o(e){var t=(new DOMParser).parseFromString(e,"text/xml"),n=t.getElementsByTagName("tracks");for(var i=0;i<n.length;i++){var s=n[i].getElementsByTagName("track");for(var o=0;o<s.length;o++){var a=u(s[o].getAttribute("name")),f=s[o].getElementsByTagName("key");for(var l=0;l<f.length;l++)a.add(parseInt(f[l].getAttribute("row"),10),parseFloat(f[l].getAttribute("value")),parseInt(f[l].getAttribute("interpolation"),10))}}r.ready()}function u(e){var t=n.getIndexForName(e);return t>-1?n.getTrack(t):(n.createIndex(e),n.getTrack(n.getTrackLength()-1))}function a(e,t){r[e]=t}function f(){}var t,n=new JSRocket.SyncData,r={ready:function(){},error:function(){}};if(e.rocketXML===""||e.rocketXML===undefined||e.rocketXML===undefined)throw"[jsRocket] rocketXML is not set, try _syncDevice.setConfig({'rocketXML':'url/To/RocketXML.rocket'})";return i(e.rocketXML),{load:i,getTrack:u,update:f,on:a}},JSRocket.SyncDevice=function(){"use strict";function s(e){e==="demo"?t=new JSRocket.SyncDevicePlayer(r):t=new JSRocket.SyncDeviceClient(r),t.on("ready",a),t.on("update",f),t.on("play",l),t.on("pause",c)}function o(){return r}function u(e){for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t]);return r}function a(){e=!0,i.ready()}function f(e){i.update(e)}function l(){i.play()}function c(){i.pause()}function h(n){return e?t.getTrack(n):null}function p(e){Math.floor(e)!==n&&(n=Math.floor(e),t.update(n))}function d(e,t){i[e]=t}var e=!1,t,n,r={socketURL:"ws://localhost:8080",rocketXML:""},i={ready:function(){},update:function(){},play:function(){},pause:function(){}};return{init:s,setConfig:u,getConfig:o,getTrack:h,update:p,on:d}};